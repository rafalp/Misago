{% load i18n misago_capture misago_formats %}

{% if is_request_htmx %}
  {% include "misago/snackbars.html" %}
{% endif %}

<div class="poll-results">
  <ul class="poll-results-choices">
    {% for choice in poll_results %}
      <li class="poll-results-choice">
        <div class="poll-results-choice-name">
          {{ choice.name }}
          {% if choice.id in user_poll_votes %}
            <span class="poll-results-choice-bullet" title="{% translate 'Your vote' context 'poll results' %}"></span>
          {% endif %}
          <span class="poll-results-choice-stats-sm">
            <span class="poll-results-choice-stats-separator">&bull;</span>
            {% blocktrans trimmed count votes=choice.votes context "poll results" %}
              {{ votes }} vote
            {% plural %}
              {{ votes }} votes
            {% endblocktrans %}
            <span class="poll-results-choice-stats-separator">&bull;</span>
            {{ choice.share }}%
          </span>
        </div>
        <div class="poll-results-choice-bar">
          <div class="progress">
            <div class="progress-bar" role="progressbar" aria-valuenow="{{ choice.share }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ choice.share }}%;">
            </div>
          </div>
        </div>
        <div class="poll-results-choice-stats">
          {% blocktrans trimmed count votes=choice.votes context "poll results" %}
            {{ votes }} vote
          {% plural %}
            {{ votes }} votes
          {% endblocktrans %}
          <span class="poll-results-choice-stats-separator">&bull;</span>
          {{ choice.share }}%
        </div>
      </li>
      {% if show_poll_voters %}
        <li class="poll-results-choice-voters">
          {% for voter in choice.voters %}
            {% if voter.id %}
              <a href="{% url 'misago:user' pk=voter.id slug=voter.slug %}" class="poll-voter">{{ voter.username }}</a>{% if not forloop.last %}, {% endif %}
            {% else %}
              <span class="poll-voter">{{ voter.username }}</span>{% if not forloop.last %}, {% endif %}
            {% endif %}
          {% empty %}
            <span class="poll-results-choice-voters-empty">
              {% translate "No one voted for this choice" context "poll results" %}
            </span>
          {% endfor %}
        </li>
      {% endif %}
    {% endfor %}
  </ul>
  {% if allow_poll_vote %}
    <div class="poll-footer">
      <div class="poll-info">
        {% if poll.votes %}
          {% blocktrans trimmed count votes=poll.votes context "poll info" %}
            {{ votes }} vote in total.
          {% plural %}
            {{ votes }} votes in total.
          {% endblocktrans %}
        {% else %}
          {% translate "Nobody has voted yet." context "poll info" %}
        {% endif %}
        {% if poll.has_ended %}
          {% translate "Poll has ended." context "poll info" %}
        {% elif poll.is_closed %}
          {% translate "Poll is closed." context "poll info" %}
        {% elif poll.duration %}
          {% capture trimmed as poll_end %}
            <span
              title="{{ poll.ends_at|date:'DATETIME_FORMAT' }}"
              misago-timestamp="{{ poll.ends_at.isoformat }}"
            >
            {{ poll.ends_at|date_relative }}
            </span>
          {% endcapture %}
          {% blocktrans trimmed with timestamp=poll_end|safe context "poll info" %}
            Voting ends on {{ timestamp }}.
          {% endblocktrans %}
        {% endif %}
        {% if poll.is_public %}
          {% translate "Votes are public." context "poll info" %}
        {% endif %}
      </div>
      <div class="poll-buttons">
        {% if poll.is_public and not show_poll_voters %}
          <a href="{{ poll_voters_url }}"
            class="btn btn-default"
            type="button"
            hx-boost="true"
          >
            {% translate "View voters" context "poll footer btn" %}
          </a>
        {% elif show_poll_voters %}
          <a href="{{ poll_results_url }}"
            class="btn btn-default"
            type="button"
            hx-boost="true"
          >
            {% translate "Hide voters" context "poll footer btn" %}
          </a>
        {% endif %}
        <a href="{{ poll_vote_url }}"
          class="btn btn-default"
          type="button"
          hx-boost="true"
        >
          {% translate "Change vote" context "poll footer btn" %}
        </a>
      </div>
    </div>
  {% endif %}
</div>