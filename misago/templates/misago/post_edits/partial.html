{% load i18n misago_avatars misago_formats %}

{% if is_request_htmx %}
<title>
  {% if post_edit %}
    {% blocktranslate trimmed with post=post_number edit=page.number context "thread post edits page title" %}
      Post #{{ post }} edit #{{ edit }}
    {% endblocktranslate %}
  {% else %}
    {% blocktranslate trimmed with post=post_number context "thread post edits page title" %}
      Post #{{ post }} edits
    {% endblocktranslate %}
  {% endif %} | {{ thread }} | {{ settings.forum_name }}
</title>
{% endif %}

<div id="misago-htmx-root">
  <div id="misago-page-scroll-target" class="scroll-target"></div>
  {% if paginator.num_pages > 1 %}
    {% include "misago/post_edits/paginator.html" %}
  {% endif %}
  {% if post_edit %}
    <div class="post-edit-card">
      <div class="post-edit-card-header">
        <div class="post-edit-card-revision">
          {% blocktranslate trimmed with edit=page.number context "thread post edits page title" %}
            Edit #{{ edit }}
          {% endblocktranslate %}
        </div>
      </div>
      <div class="post-edit-card-body">
        {% if edit_diff %}
          {% if edit_diff.title %}
            <div class="post-edit-card-section">
              <h3 class="post-edit-card-section-title">
                {% translate "Thread title" context "post edit diff section title" %}
              </h3>
              {% for line in edit_diff.title.lines %}
                {% if line.text.strip or line.diff %}
                  <pre class="post-edit-diff-line post-edit-diff-line-{% if line.marker == '-' %}removed{% elif line.marker == '+' %}added{% else %}neutral{% endif %}">{% if line.marker == "?" %}{% for diff in line.diff %}{% if diff.marker == "-" %}<del>{{ diff.text }}</del>{% elif diff.marker == "+" %}<ins>{{ diff.text }}</ins>{% else %}{{ diff.text }}{% endif %}{% endfor %}{% else %}{{ line.text }}{% endif %}</pre>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
          {% if edit_diff.content %}
            <div class="post-edit-card-section">
              <h3 class="post-edit-card-section-title">
                {% translate "Content" context "post edit diff section title" %}
              </h3>
              <ol class="post-edit-diff-lines">
                {% for line in edit_diff.content.lines %}
                  <li>
                    {% if line.text.strip or line.diff %}
                      <pre class="post-edit-diff-line post-edit-diff-line-{% if line.marker == '-' %}removed{% elif line.marker == '+' %}added{% else %}neutral{% endif %}">{% if line.marker == "?" %}{% for diff in line.diff %}{% if diff.marker == "-" %}<del>{{ diff.text }}</del>{% elif diff.marker == "+" %}<ins>{{ diff.text }}</ins>{% else %}{{ diff.text }}{% endif %}{% endfor %}{% else %}{{ line.text }}{% endif %}</pre>
                    {% endif %}
                  </li>
                {% endfor %}
              </ol>
            </div>
          {% endif %}
          {% if edit_diff.attachments %}
            <div class="post-edit-card-section">
              <h3 class="post-edit-card-section-title">
                {% translate "Attachments" context "post edit diff section title" %}
              </h3>
              {{ post_edit.attachments }}
            </div>
          {% endif %}
        {% endif %}
      </div>
    </div>
    {% if paginator.num_pages > 1 %}
      {% include "misago/post_edits/paginator.html" with scroll=True %}
    {% endif %}
  {% else %}
    BLANKSLATE
  {% endif %}
</div>