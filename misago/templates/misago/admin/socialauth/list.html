{% extends "misago/admin/generic/list.html" %}
{% load i18n misago_admin_form misago_capture %}


{% block table-header %}
<th>{% trans "Provider" %}</th>
<th style="width: 1px;">&nbsp;</th>
{% endblock table-header %}


{% block table-items %}
  {{ block.super }}
  {% for provider in inactive_providers %}
    <tr>
      <td class="pr-0 small">
        <a href="{% url 'misago:admin:settings:socialauth:edit' pk=provider.provider %}" class="item-name">
          {{ provider.name }}
        </a>
      </td>
      <td>
        <a href="{% url 'misago:admin:settings:socialauth:edit' pk=provider.provider %}" class="btn btn-light btn-sm" data-tooltip="top" title="{% trans 'Setup login with this provider' %}">
          {% trans "Setup" %}
        </a>
      </td>
    </tr>
  {% endfor %}
{% endblock table-items %}


{% block table-row-blankslate %}{% endblock table-row-blankslate %}


{% block table-row %}
<td class="pr-0 small">
  <a href="{% url 'misago:admin:settings:agreements:edit' pk=item.pk %}" class="item-name">
    {{ item.get_final_title }}
  </a>
</td>
<td class="badges-list">
  {% if item.is_active %}
    <span class="badge badge-success" data-tooltip="top" title="{% trans 'Users are required to accept this agreement to use the site' %}">
      {% trans "Active" %}
    </span>
  {% endif %}
</td>
<td class="small">
  {{ item.get_type_display }}
</td>
<td class="small">
  {% capture trimmed as created_on %}
    <abbr data-timestamp="{{ item.created_on.isoformat }}" data-format="LL"></abbr>
  {% endcapture %}
  {% capture trimmed as created_by %}
    {% if item.created_by %}
      <a href="{{ item.created_by.get_absolute_url }}" class="item-title">{{ item.created_by }}</a>
    {% else %}
      <span class="item-title">{{ item.created_by_name }}</span>
    {% endif %}
  {% endcapture %}
  {% blocktrans trimmed with created_on=created_on|safe created_by=created_by|safe %}
    {{ created_on }} by {{ created_by }}
  {% endblocktrans %}
</td>
<td class="small">
  {% if item.last_modified_on %}
    {% capture trimmed as last_modified_on %}
      <abbr data-timestamp="{{ item.last_modified_on.isoformat }}" data-format="LL">
        {{ item.last_modified_on }}
      </abbr>
    {% endcapture %}
    {% capture trimmed as last_modified_by %}
      {% if item.last_modified_by %}
        <a href="{{ item.last_modified_by.get_absolute_url }}" class="item-title">{{ item.last_modified_by }}</a>
      {% else %}
        <span class="item-title">{{ item.last_modified_by }}</span>
      {% endif %}
    {% endcapture %}
    {% blocktrans trimmed with last_modified_on=last_modified_on|safe last_modified_by=last_modified_by|safe %}
      {{ last_modified_on }} by {{ last_modified_by }}
    {% endblocktrans %}
  {% else %}
    <em>{% trans "never" %}</em>
  {% endif %}
</td>
<td>
  <div class="dropdown">
    <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="item-optioms-{{ item.pk }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fas fa-ellipsis-h"></i>
    </button>
    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="item-optioms-{{ item.pk }}">
      {% if not item.is_active %}
        <form action="{% url 'misago:admin:settings:agreements:set-as-active' pk=item.pk %}" method="post" data-set-as-active-confirmation="true">
          {% csrf_token %}
          <button class="dropdown-item">
            {% trans "Set as active" %}
          </button>
        </form>
      {% else %}
        <form action="{% url 'misago:admin:settings:agreements:disable' pk=item.pk %}" method="post" data-disable-confirmation="true">
          {% csrf_token %}
          <button class="dropdown-item">
            {% trans "Disable agreement" %}
          </button>
        </form>
      {% endif %}
      <a class="dropdown-item" href="{% url 'misago:admin:settings:agreements:edit' pk=item.pk %}">
        {% trans "Edit agreement" %}
      </a>
      <form action="{% url 'misago:admin:settings:agreements:delete' pk=item.pk %}" method="post" data-delete-confirmation="true">
        {% csrf_token %}
        <button class="dropdown-item">
          {% trans "Remove agreement" %}
        </button>
      </form>
    </div>
  </div>
</td>
{% endblock %}
